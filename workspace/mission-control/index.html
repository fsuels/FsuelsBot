<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="refresh" content="15">
<title>Mission Control</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #0d1117;
  color: #e6edf3;
  min-height: 100vh;
  padding: 20px;
}
.container { max-width: 1200px; margin: 0 auto; }

/* Header */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid #21262d;
}
.header h1 {
  font-size: 24px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.status-badge {
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
}
.status-badge.working { background: rgba(52,211,153,0.15); color: #34d399; }
.status-badge.idle { background: rgba(139,148,158,0.15); color: #8b949e; }
.live-dot {
  width: 10px;
  height: 10px;
  background: #3fb950;
  border-radius: 50%;
  animation: pulse 2s infinite;
}
@keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }

/* Deadline Banner */
.deadline-banner {
  background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
  border-radius: 12px;
  padding: 16px 20px;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.deadline-text { font-size: 16px; font-weight: 600; }
.deadline-days { font-size: 28px; font-weight: 700; }

/* Task Board Grid */
.task-board {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}

/* Lane Cards */
.lane {
  background: #161b22;
  border: 1px solid #30363d;
  border-radius: 12px;
  padding: 16px;
  min-height: 200px;
}
.lane-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
  padding-bottom: 12px;
  border-bottom: 1px solid #21262d;
}
.lane-title {
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}
.lane-count {
  background: #21262d;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 12px;
  color: #8b949e;
}

/* Bot Current - Special styling */
.lane.bot-current {
  border-color: #238636;
  background: linear-gradient(135deg, #161b22 0%, #0d1a0f 100%);
}
.lane.bot-current .lane-title { color: #3fb950; }

/* Human Lane - Special styling */
.lane.human {
  border-color: #1f6feb;
  background: linear-gradient(135deg, #161b22 0%, #0d1117 100%);
}
.lane.human .lane-title { color: #58a6ff; }

/* Task Items */
.task-item {
  background: #0d1117;
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 8px;
  border-left: 3px solid #30363d;
  cursor: pointer;
  transition: all 0.2s;
}
.task-item:hover {
  background: #1c2128;
  transform: translateX(4px);
}
.task-item.in-progress {
  border-left-color: #3fb950;
  background: rgba(63,185,80,0.05);
}
.task-item.pending { border-left-color: #8b949e; }
.task-item.human-task { border-left-color: #58a6ff; }

.task-id {
  font-size: 11px;
  color: #8b949e;
  margin-bottom: 4px;
  font-family: monospace;
}
.task-title-text {
  font-size: 14px;
  color: #e6edf3;
  margin-bottom: 6px;
  font-weight: 500;
}
.task-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}
.task-plan {
  font-size: 11px;
  color: #58a6ff;
  text-decoration: none;
  background: rgba(88,166,255,0.1);
  padding: 2px 6px;
  border-radius: 4px;
}
.task-plan:hover { background: rgba(88,166,255,0.2); }
.task-estimate {
  font-size: 11px;
  color: #8b949e;
  background: #21262d;
  padding: 2px 6px;
  border-radius: 4px;
}

/* Done Section */
.done-section {
  background: #161b22;
  border: 1px solid #30363d;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 24px;
}
.done-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  padding-bottom: 12px;
}
.done-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 8px;
}
.done-grid.collapsed { display: none; }
.done-item {
  background: #0d1117;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 13px;
  color: #8b949e;
  display: flex;
  align-items: center;
  gap: 8px;
}
.done-item .check { color: #3fb950; }

/* Scheduled Section */
.scheduled-section {
  background: #161b22;
  border: 1px solid #30363d;
  border-radius: 12px;
  padding: 16px;
}
.scheduled-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 8px;
}
.scheduled-item {
  background: #0d1117;
  padding: 10px;
  border-radius: 6px;
  font-size: 12px;
}
.scheduled-title { color: #e6edf3; margin-bottom: 4px; }
.scheduled-time { color: #8b949e; font-size: 11px; }

/* Footer */
.footer {
  margin-top: 20px;
  padding-top: 16px;
  border-top: 1px solid #21262d;
  display: flex;
  justify-content: space-between;
  font-size: 13px;
  color: #484f58;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .task-board { grid-template-columns: 1fr; }
  .deadline-banner { flex-direction: column; gap: 8px; text-align: center; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1><span class="live-dot"></span> Mission Control</h1>
    <div class="status-badge working" id="globalStatus">WORKING</div>
  </div>

  <div class="deadline-banner">
    <span class="deadline-text">üíï Valentine's Day Order Cutoff</span>
    <span class="deadline-days" id="deadlineDays">-- days</span>
  </div>

  <div class="task-board" id="taskBoard">
    <!-- Bot Current -->
    <div class="lane bot-current">
      <div class="lane-header">
        <span class="lane-title">ü§ñ Bot ‚Äî Working Now</span>
        <span class="lane-count" id="botCurrentCount">0</span>
      </div>
      <div id="botCurrentTasks">Loading...</div>
    </div>

    <!-- Bot Queue -->
    <div class="lane">
      <div class="lane-header">
        <span class="lane-title">üìã Bot ‚Äî Queue</span>
        <span class="lane-count" id="botQueueCount">0</span>
      </div>
      <div id="botQueueTasks">Loading...</div>
    </div>

    <!-- Human Tasks -->
    <div class="lane human">
      <div class="lane-header">
        <span class="lane-title">üë§ Francisco ‚Äî Your Tasks</span>
        <span class="lane-count" id="humanCount">0</span>
      </div>
      <div id="humanTasks">Loading...</div>
    </div>
  </div>

  <!-- Done Today -->
  <div class="done-section">
    <div class="done-header" onclick="toggleDone()">
      <span class="lane-title">‚úÖ Done Today <span class="lane-count" id="doneCount">0</span></span>
      <span id="doneToggle">‚ñº Show</span>
    </div>
    <div class="done-grid collapsed" id="doneTasks"></div>
  </div>

  <!-- Scheduled -->
  <div class="scheduled-section">
    <div class="lane-header">
      <span class="lane-title">‚è∞ Scheduled (Cron Jobs)</span>
    </div>
    <div class="scheduled-grid" id="scheduledTasks">Loading...</div>
  </div>

  <div class="footer">
    <span>Auto-refreshes every 15 seconds</span>
    <span id="lastUpdate"></span>
  </div>
</div>

<script>
async function loadTaskBoard() {
  try {
    const resp = await fetch('../memory/tasks.json?' + Date.now());
    const data = await resp.json();
    
    const tasks = data.tasks || {};
    const lanes = data.lanes || {};
    
    // Calculate deadline
    const deadline = new Date('2026-02-10');
    const today = new Date();
    const daysLeft = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
    document.getElementById('deadlineDays').textContent = daysLeft + ' days';
    
    // Render Bot Current
    const botCurrentIds = lanes.bot_current || [];
    document.getElementById('botCurrentCount').textContent = botCurrentIds.length;
    document.getElementById('botCurrentTasks').innerHTML = botCurrentIds.map(id => {
      const t = tasks[id];
      if (!t) return '';
      return renderTask(id, t, 'in-progress');
    }).join('') || '<div style="color:#8b949e;font-size:13px;">No active task</div>';
    
    // Render Bot Queue
    const botQueueIds = lanes.bot_queue || [];
    document.getElementById('botQueueCount').textContent = botQueueIds.length;
    document.getElementById('botQueueTasks').innerHTML = botQueueIds.map((id, idx) => {
      const t = tasks[id];
      if (!t) return '';
      return renderTask(id, t, 'pending', idx === 0 ? 'NEXT' : null);
    }).join('') || '<div style="color:#8b949e;font-size:13px;">Queue empty üéâ</div>';
    
    // Render Human Tasks
    const humanIds = lanes.human || [];
    document.getElementById('humanCount').textContent = humanIds.length;
    document.getElementById('humanTasks').innerHTML = humanIds.map(id => {
      const t = tasks[id];
      if (!t) return '';
      return renderTask(id, t, 'human-task');
    }).join('') || '<div style="color:#8b949e;font-size:13px;">All done! üéâ</div>';
    
    // Render Done Today
    const doneIds = lanes.done_today || [];
    document.getElementById('doneCount').textContent = doneIds.length;
    document.getElementById('doneTasks').innerHTML = doneIds.map(id => {
      const t = tasks[id];
      if (!t) return '';
      return `<div class="done-item"><span class="check">‚úì</span>${t.title}</div>`;
    }).join('') || '<div class="done-item">Nothing yet</div>';
    
    // Render Scheduled
    const schedIds = lanes.scheduled || [];
    document.getElementById('scheduledTasks').innerHTML = schedIds.map(id => {
      const t = tasks[id];
      if (!t) return '';
      return `
        <div class="scheduled-item">
          <div class="scheduled-title">${t.title}</div>
          <div class="scheduled-time">${t.schedule || ''}</div>
        </div>
      `;
    }).join('') || '<div style="color:#8b949e;">No scheduled tasks</div>';
    
    document.getElementById('lastUpdate').textContent = 'Updated: ' + new Date().toLocaleTimeString();
    
  } catch(e) {
    console.error('Failed to load tasks:', e);
    document.getElementById('botCurrentTasks').innerHTML = '<div style="color:#f85149;">Failed to load tasks.json</div>';
  }
}

function renderTask(id, task, statusClass, badge) {
  const planLink = task.plan ? `<a class="task-plan" href="../${task.plan}" target="_blank">üìÑ ${task.plan.split('/').pop()}</a>` : '';
  const estimate = task.estimate ? `<span class="task-estimate">‚è± ${task.estimate}</span>` : '';
  const badgeHtml = badge ? `<span class="task-estimate" style="background:#238636;color:#fff;">${badge}</span>` : '';
  
  return `
    <div class="task-item ${statusClass}">
      <div class="task-id">${id}</div>
      <div class="task-title-text">${task.title}</div>
      <div class="task-meta">
        ${planLink}
        ${estimate}
        ${badgeHtml}
      </div>
    </div>
  `;
}

function toggleDone() {
  const grid = document.getElementById('doneTasks');
  const toggle = document.getElementById('doneToggle');
  if (grid.classList.contains('collapsed')) {
    grid.classList.remove('collapsed');
    toggle.textContent = '‚ñ≤ Hide';
  } else {
    grid.classList.add('collapsed');
    toggle.textContent = '‚ñº Show';
  }
}

loadTaskBoard();
</script>
</body>
</html>
